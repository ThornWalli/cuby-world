import{m as we,k as ie,o as re,l as ae,P as ge,S as T,n as x,G as be,V as g,p as ve,I as ye,D as Pe,q as B,e as O,j as P,r as xe,s as Se,t as Ue,u as Ee,d as V,F as X,v as K,f as _e,w as J,x as q,y as $e,A as Me,U as Re,M as ce,B as le,O as G,g as k,h as Ce,z,c as ue,a as Fe,b as N,W as Te,E as Ie,H as ke,J as Q,K as Ae,N as Le,Q as D,R as je}from"./BGNsA0yd.js";import{d as j,k as de,r as b,o as H,L as he,E as M,y as v,C as E,B as C,D as L,H as Oe,z as A,x as _,M as R,I as ze,J as Be,A as Z,F as Ne,_ as W,K as De,N as ee,G as Ve}from"./CtjQLM9l.js";import{u as Ge}from"./BOlIlr6g.js";function He(o){return we(ie,o)}function We(){return He(1)}function te(o,e){return re(function(t,s){var n=0;t.subscribe(ae(s,function(i){return o.call(e,i,n++)&&s.next(i)}))})}function Ye(o,e){return e===void 0&&(e=ie),o=o??Xe,re(function(t,s){var n,i=!0;t.subscribe(ae(s,function(c){var r=e(c);(i||!o(n,r))&&(i=!1,n=r,s.next(c))}))})}function Xe(o,e){return o===e}class Ke{id;name;unit;constructor({id:e,name:t}){this.id=e||crypto.randomUUID(),this.name=t}setUnit(e){this.unit=e,ge.TYPE in this.unit.modules&&this.unit.modules.player.setPlayer(this),console.log("Player unit set:",this.unit.name)}get position(){if(this.unit)return this.unit.root.position;throw new Error("Player unit is not set, cannot get position")}set position(e){if(this.unit)this.unit.setPosition(e);else throw new Error("Player unit is not set, cannot update position")}moveTo(e){if(this.unit)this.unit.modules.movement.moveTo(e);else throw new Error("Player unit is not set, cannot move to position")}}class I{constructor(e){this.app=e}static TYPE;subscription=new T;setup(){}destroy(){this.subscription.unsubscribe()}update(){}}class pe extends I{static TYPE="unitFocus";state={};focusedUnit$=new x(1);get focusedUnit(){return this.state.focusedUnit}setPlayerAsFocusedUnit(){const e=this.app.modules.player.getPlayer();if(!e?.unit)throw new Error("No player unit to focus on");this.setFocusedUnit(e.unit)}setFocusedUnit(e){const t=this.state.focusedUnit;this.state.focusedUnit=e;const s=this.app.renderer.controls;e?(s.enabled=!1,s.update()):(s.enabled=!0,t&&(s.object.position.copy(this.app.renderer.camera.position),s.target.copy(t.root.position),s.update())),this.focusedUnit$.next(e)}unfocusUnit(){this.setFocusedUnit(void 0)}}function Je(o){o.vertexShader=`varying vec2 vUv;
`+o.vertexShader,o.vertexShader=o.vertexShader.replace("#include <begin_vertex>",`
        #include <begin_vertex>
        vUv = uv;
        `),o.fragmentShader=`varying vec2 vUv;
`+o.fragmentShader,o.fragmentShader=o.fragmentShader.replace("#include <map_fragment>",`
        #include <map_fragment>

        vec2 uv = vUv;
        float border = 0.01;

        if (uv.x < border || uv.x > (1.0 - border) || uv.y < border || uv.y > (1.0 - border)) {
            // Ã„ndern Sie die diffuseColor, um die Fugen zu erstellen
            diffuseColor.rgb = vec3(0.2, 0.2, 0.2);
        }
        `)}function qe(o,e=16){const t=o.width,s=o.height,n=[],i=o.toMatrix();for(let c=0;c<t;c+=e)for(let r=0;r<s;r+=e){const a=[];for(let m=c;m<c+e&&m<t;m++)for(let h=r;h<r+e&&h<s;h++)i[m][h]===1&&a.push(new be(new g(h,0,m)));if(a.length===0)continue;const d=a.reduce((m,h)=>(m[h.type]=m[h.type]||[],m[h.type].push(h),m),{}),y=new ve({color:13421772}),S=Object.entries(d);y.onBeforeCompile=m=>Je(m),S.forEach(([m,h])=>{const p=new ye(h[0].plane.geometry,y,h.length);p.material.side=Pe,p.castShadow=!1,p.receiveShadow=!0,p.name=`chunk_${c}_${r}_${m}`;const U=new B;h.forEach((l,f)=>{U.makeTranslation(l.position.x,l.position.y,l.position.z),p.setMatrixAt(f,U)}),n.push(p)})}return n}class F{constructor(e,t,s){if(this.data=e,this.width=t,this.height=s,e.length!==t*s)throw new Error("Data length does not match width and height")}static fromGrid(e){const t=e.length,s=e[0]?.length||0,n=e.flat();return new F(n,s,t)}clone(){return new F([...this.data],this.width,this.height)}toMatrix(){const e=[];for(let t=0;t<this.data.length;t+=this.width)e.push(this.data.slice(t,t+this.width));return e}}class Qe{constructor(e,t=new F([],0,0)){this.app=e,this._grid=t,this.mesh=new O,this.mesh.name="room",this.setupSelection()}units=new Map;mesh=new O;groundMesh;selectionMesh;_grid;get grid(){return this._grid}description;get gridSize(){return new P(this.grid.width,this.grid.height)}async add(e){await e.setup({unit:e,assetLoader:this.app.texturePreloader,room:this}),this.units.set(e.id,e),console.log("Adding unit:",e.name,"with ID:",e.id),this.mesh.add(e.root)}remove(e){this.units.delete(e.id),this.mesh.remove(e.root)}getById(e){return this.units.get(e)}setupSelection(){const t=new xe,s=.9;t.moveTo(-s/2,-s/2),t.lineTo(s/2,-s/2),t.lineTo(s/2,s/2),t.lineTo(-s/2,s/2),t.lineTo(-s/2,-s/2);const n=new Se,i=.9*(4/5);n.moveTo(-i/2,-i/2),n.lineTo(i/2,-i/2),n.lineTo(i/2,i/2),n.lineTo(-i/2,i/2),n.lineTo(-i/2,-i/2),t.holes.push(n);const c=new Ue(t);c.translate(0,0,.1),c.rotateX(-Math.PI/2);const r=new Ee({color:16777215}),a=new V(c,r);a.position.set(0,0,0),this.mesh.add(a),this.selectionMesh=a}groundChunks=[];setupGround(e){const t=new O;t.name="ground",this.groundChunks=qe(e,16),this.groundChunks.forEach(s=>t.add(s)),this.groundMesh=t,this.mesh.add(t)}updateUnitsVisibility(e){const t=new X,s=new B;s.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),t.setFromProjectionMatrix(s),this.units.forEach(n=>{const i=new K().setFromObject(n.root);n.root.visible=t.intersectsBox(i)})}updateChunksVisibility(e){const t=new X,s=new B;s.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),t.setFromProjectionMatrix(s),this.groundChunks.forEach(n=>{const i=new K().setFromObject(n);n.visible=t.intersectsBox(i)})}async setupUnits(e){await Promise.all(e.map(t=>{this.add(t)}))}getSize(){return new P(this.grid.width,this.grid.height)}update(e){this.updateChunksVisibility(this.app.renderer.camera),this.units.forEach(t=>{t.update(e)})}setSelectionPosition(e){this.selectionMesh.position.copy(e)}}class Y extends I{static TYPE="room";_selectionPosition$=new x(0);selectionPosition$=this._selectionPosition$.pipe(Ye((e,t)=>e.equals(t)));roomSubscription;state={room:void 0};static async roomFromDescription(e,t){const s=new Qe(e,t.grid);return s.description=t,s.setupGround(t.grid),await s.setupUnits(t.units||[]),s.mesh.name=t.name,s}getRoom(){return this.state.room}async fromDescription(e){const t=this.app,s=t.renderer,{room:n,player:i,unitFocus:c}=t.modules,r=await Y.roomFromDescription(t,e);if(this.roomSubscription){this.roomSubscription.unsubscribe();const a=n.getRoom();a&&s.scene.remove(a.mesh),n.setRoom(void 0)}if(n.setRoom(r),s.scene.add(r.mesh),this.roomSubscription=this.registerRoomSubscriptions(t),i&&r.description?.start){const a=new _e({position:r.description.start.position.clone(),rotation:r.description.start.rotation});i.getPlayer().setUnit(a),await r.add(a),t.modules.selection.setSelectedUnit(a),c?.setFocusedUnit(a)}s.animationLoop$.subscribe(a=>{if(r.update(a),c?.focusedUnit){const d=c.focusedUnit.getRootPosition();s.updateCamera(d),s.updateLight(d)}}),console.log("Set room:",e.name,r)}setRoom(e){this.state.room=e}subscribeGroundSelection(e){const t=this.getRoom();return e.register(t.mesh.getObjectByName("ground")).hoverIntersect$.pipe(We(),te(n=>n.object?.parent?.name==="ground"),J(),te(({worldPosition:n})=>!!n)).subscribe(({worldPosition:n})=>{t.setSelectionPosition(n),this._selectionPosition$.next(n)})}registerRoomSubscriptions(e){const t=new T,s=e.modules.room.getRoom(),n=e.modules.player.getPlayer(),i=e.renderer;let c,r=null;return t.add(e.modules.placement.startPlace$.subscribe(a=>{r=a.getRootPosition().clone(),console.log("Start placing - ignoring selection"),c=this.selectionPosition$.subscribe(d=>{console.log("Placing at position:",d,q(d)),a.setPosition(q(d))})})),t.add(e.modules.placement.stopPlace$.subscribe(()=>{c?.unsubscribe()})),t.add(e.modules.placement.abortPlace$.subscribe(a=>{r&&a.setPosition(r)})),i.modules.intersection&&(t.add(this.subscribeGroundSelection(i.modules.intersection)),t.add(i.modules.intersection.register(s.mesh).clickIntersect$.pipe(J()).subscribe(a=>{if(a){const{unit:d,object:y,worldPosition:S}=a;e.modules.placement.hasPlace()?(e.modules.placement.stopPlace(),e.modules.selection.setSelectedUnit(null)):d&&e.modules.selection.getSelectedUnit()?.id===d?.id?n.moveTo(d.getPosition()):d?e.modules.selection.setSelectedUnit(d):(console.log("Current intersected object:",d,y,S),n.moveTo($e(S)))}else console.log("No intersected object")}))),t}}class Ze extends I{static TYPE="player";state={player:void 0};getPlayer(){return this.state.player}setPlayer(e){this.state.player=e}}class et extends I{static TYPE="selection";state={selectedUnit:null};selectUnit$=new x(1);getSelectedUnit(){return this.state.selectedUnit}setSelectedUnit(e){if(e&&!e.modules.selection)throw new Error("Unit does not have selection module");const t=this.app.modules.player.getPlayer(),s=[];!e&&t.unit.id===this.state.selectedUnit?.id||(this.state.selectedUnit?.modules.selection?.unselect(),e?(e.modules.selection?.select(),this.state.selectedUnit=e,s.push(e.mesh)):this.state.selectedUnit=null,this.app.renderer.setSelectedObjects(s),this.selectUnit$.next(e))}setSelectedObjects(e){this.app.renderer.setSelectedObjects(e)}}class tt extends I{static TYPE="placement";state={placedUnit:null};unitSubscription;abortPlace$=new x(1);startPlace$=new x(1);stopPlace$=new x(1);getPlaceUnit(){return this.state.placedUnit}hasPlace(){return!!this.state.placedUnit}abortPlace(){if(!this.state.placedUnit)throw new Error("No unit is being placed");const e=this.state.placedUnit;if(!e.modules.placement)throw new Error("Unit does not have placement module");this.state.placedUnit=null,this.abortPlace$.next(e),e.modules.placement.abortPlace()}startPlace(e){if(!e.modules.placement)throw new Error("Unit does not have placement module");this.state.placedUnit=e,this.startPlace$.next(e),e.modules.placement.startPlace()}stopPlace(){if(!this.state.placedUnit)throw new Error("No unit is being placed");const e=this.state.placedUnit;if(!e.modules.placement)throw new Error("Unit does not have placement module");const t=this.state.placedUnit.getPosition();this.state.placedUnit=null,this.stopPlace$.next(t),e.modules.placement.stopPlace()}}let st=class{constructor(e,t=[]){this.renderer=e,t.push(Y,Ze,pe,et,tt);const s=t.map(n=>{const i=new n(this);return[n.TYPE,i]});this.modules=Object.fromEntries(s),Object.values(this.modules).forEach(n=>n.setup())}texturePreloader=new Me;state={};roomSubscription;modules;destroy(){this.roomSubscription?.unsubscribe()}resetCamera(){this.renderer.resetCamera()}};class nt{id;name;description;grid;units;start;constructor({id:e,name:t,description:s,grid:n,units:i,start:c}){this.id=e,this.name=t,this.description=s,this.grid=n,this.units=i||[],this.start=c}}class ot extends Re{static KEY="box";static NAME="Box";constructor(e={}){super({size:new g(1,1/3,1),...e,name:"Block",selectable:!0,placeable:!0,options:{color:14090240,...e.options}})}createMesh(){const e=new ce({color:this.options.color}),t=this.size,s=new le(t.z,t.y,t.x),n=new V(s,e);return n.name=G.MESH,n.castShadow=!0,n.position.set(0,t.y/2,0),n.add(it()),this.materialReady$.next(),n}}function it(){const o=new ce({color:16711680}),e=new le(1,1,1),t=new V(e,o);return t.name=G.MESH,t.castShadow=!0,t.position.set(0,1/2+.5,0),t}class rt extends nt{constructor(){super({id:"default",name:"Default Room",description:"This is the default room in Cuby World.",grid:F.fromGrid([[1,1,1,1,1,1,0,1,0,1,0],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,0,1,0,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,0,1,0,1,0],[1,1,1,1,1,1,0,0,0,0,0],[1,1,1,1,1,1,0,0,0,0,0],[1,1,1,1,1,1,0,0,0,0,0],[1,1,1,1,1,1,0,0,0,0,0],[1,1,1,1,1,1,0,0,0,0,0],[1,1,1,1,1,1,0,0,0,0,0]]),start:{position:new g(2,0,2),rotation:z.RIGHT},units:[new ot({size:new g(3,1,3),position:new g(3,0,0),rotation:z.UP,options:{color:65280}}),new k({position:new g(0,0,0)}),new Ce({position:new g(0,0,2),rotation:z.RIGHT}),new k({position:new g(6,0,0)}),new k({position:new g(6,0,4)}),new k({position:new g(0,0,4)})]})}}const at=j({__name:"CameraControl",props:{app:{}},setup(o){const e=o,t=new T,s=de(()=>e.app.modules.unitFocus);function n(c){c?s.value.setPlayerAsFocusedUnit():s.value.unfocusUnit()}const i=b(!1);return H(()=>{t.add(s.value.focusedUnit$.subscribe(c=>{c?i.value=!0:i.value=!1}))}),he(()=>{t.unsubscribe()}),(c,r)=>(v(),M(ue,{class:"cw-panel-camera-control",title:"Camera"},{default:E(()=>[C(Fe,{"model-value":i.value,"onUpdate:modelValue":n},{default:E(()=>[...r[1]||(r[1]=[L(" Focused Cuby ",-1)])]),_:1},8,["model-value"]),C(N,{disabled:i.value,onClick:r[0]||(r[0]=a=>c.app.resetCamera())},{default:E(()=>[...r[2]||(r[2]=[L(" Reset Camera ",-1)])]),_:1},8,["disabled"])]),_:1}))}}),ct={class:"image"},lt={key:0},ut={key:1,class:"actions"},dt=j({__name:"UnitPreview",props:{unit:{}},setup(o){const e=b(null),t=o,s=b();function n(l){i(l),y(l.mesh),m.render(c,r)}function i(l){const f=l.getPosition(),w=l.getRootRotation(),u=l.size,fe={Pos:`${f.x.toFixed(2)}x${f.y.toFixed(2)}x${f.z.toFixed(2)}`,Rot:`${w.x.toFixed(2)}x${w.y.toFixed(2)}`,URot:`${t.unit.rotation}`,Size:`${u.x}x${u.y}`};s.value=Object.entries(fe)}let c,r,a;function d(){c=new Ie;const l=1;r=new ke(l*-1,l*1,l*1,l*-1,1,1e3),r.position.set(20,20,20),r.lookAt(0,0,0);const f=new g(10,5,15),w=1;let u;u=new Q(16777215,3),u.position.set(f.x,f.y,f.z),u.shadow.mapSize.width=128,u.shadow.mapSize.height=128,u.shadow.camera.left=-w,u.shadow.camera.right=w,u.shadow.camera.top=w,u.shadow.camera.bottom=-w,u.shadow.camera.near=1,u.shadow.camera.far=50,u.shadow.camera.updateProjectionMatrix(),c.add(u),u=new Q(16777215,.6),u.position.set(0,3,0),u.castShadow=!0,u.shadow.mapSize.width=128,u.shadow.mapSize.height=128,u.shadow.camera.left=-w,u.shadow.camera.right=w,u.shadow.camera.top=w,u.shadow.camera.bottom=-w,u.shadow.camera.near=1,u.shadow.camera.far=50,u.shadow.camera.updateProjectionMatrix(),c.add(u)}function y(l){if(a){c.remove(a),console.log(a,a.geometry,a.material),a.geometry.dispose();const f=[];Array.isArray(a.material)?f.push(...a.material):f.push(a.material),f.forEach(w=>w.dispose())}if(l){a=l.clone();const f=a.getObjectByName(G.MESH_OUTLINE);f&&(f.visible=!1),c.add(a),a.position.set(0,0,0),a.rotation.set(0,-Math.PI/2,0)}}const S=b(!1);let m;function h(){if(!e.value){console.error("Canvas-Element wurde nicht gefunden.");return}d(),m=new Te({canvas:e.value,alpha:!0});const l=e.value;l&&m.setSize(l.offsetWidth,l.offsetHeight),S.value=!0}H(()=>{h(),p(t.unit)});function p(l){U?.unsubscribe(),U=new T,U.add(l.materialReady$.subscribe(()=>{console.log("Unit ready",l),n(l)})),U.add(l.rotate$.subscribe(f=>{console.log("Unit rotation",f),i(l)}))}let U;return Oe(()=>t.unit,()=>{p(t.unit)}),(l,f)=>(v(),M(ue,{class:"cw-panel-unit-preview",title:l.unit.name},{default:E(()=>[A("div",ct,[A("canvas",{ref_key:"canvasEl",ref:e},null,512)]),s.value?.length?(v(),_("ul",lt,[(v(!0),_(ze,null,Be(s.value,([w,u])=>(v(),_("li",{key:w},[A("span",null,Z(w)+":",1),A("span",null,Z(u),1)]))),128))])):R("",!0),l.$slots.actions?(v(),_("div",ut,[Ne(l.$slots,"actions",{},void 0,!0)])):R("",!0)]),_:3},8,["title"]))}}),ht=W(dt,[["__scopeId","data-v-0c8bda6a"]]);class pt extends Ae{static TYPE="intersection";state={};raycaster;mouse;listeners=[];constructor(e){super(e),this.raycaster=new Le,this.mouse=new P}setup(){let e=se(this.renderer.el);this.subscription.add(D(this.renderer.el,"pointermove").subscribe(t=>{const s=new P(this.renderer.el.offsetWidth,this.renderer.el.offsetHeight),n=(t.clientX-e.x)/s.x*2-1,i=-((t.clientY-e.y)/s.y)*2+1;this.mouse=new P(n,i)})),this.subscription.add(D(this.renderer.el,"pointerdown").subscribe(t=>{const s=new P(this.renderer.el.offsetWidth,this.renderer.el.offsetHeight);e=se(this.renderer.el);const n=(t.clientX-e.x)/s.x*2-1,i=-((t.clientY-e.y)/s.y)*2+1;this.raycaster.setFromCamera(new P(n,i),this.renderer.camera),this.listeners.forEach(c=>{const r=this.raycaster.intersectObject(c.mesh,!0);r.length>0&&r[0]&&(c.clickIntersect$.next(r[0]),c.clickIntersects$.next(r))})}))}register(e){const t=new x(0),s=new x(0),n=new x(0),i=this.listeners.find(a=>a.mesh===e);if(i)return i;const r={mesh:e,hoverIntersect$:t,clickIntersect$:s,clickIntersects$:n,unregister:()=>{const a=this.listeners.findIndex(d=>d.mesh===e);a!==-1&&this.listeners.splice(a,1)}};return this.listeners.push(r),r}update(){const e=this.mouse;this.mouse.copy(e),this.raycaster.setFromCamera(e,this.renderer.camera),this.listeners.forEach(t=>{const s=this.raycaster.intersectObject(t.mesh,!0);t.hoverIntersect$.next(s)})}}function se(o){const{left:e,top:t}=o.getBoundingClientRect();return new P(e,t)}const mt=new RegExp("([\\p{Ll}\\d])(\\p{Lu})","gu"),ft=new RegExp("(\\p{Lu})([\\p{Lu}][\\p{Ll}])","gu"),wt=new RegExp("(\\d)\\p{Ll}|(\\p{L})\\d","u"),gt=/[^\p{L}\d]+/giu,ne="$1\0$2",oe="";function me(o){let e=o.trim();e=e.replace(mt,ne).replace(ft,ne),e=e.replace(gt,"\0");let t=0,s=e.length;for(;e.charAt(t)==="\0";)t++;if(t===s)return[];for(;e.charAt(s-1)==="\0";)s--;return e.slice(t,s).split(/\0/g)}function bt(o){const e=me(o);for(let t=0;t<e.length;t++){const s=e[t],n=wt.exec(s);if(n){const i=n.index+(n[1]??n[2]).length;e.splice(t,1,s.slice(0,i),s.slice(i))}}return e}function vt(o,e){const[t,s,n]=xt(o,e);return t+s.map(Pt(e?.locale)).join(e?.delimiter??" ")+n}function yt(o,e){return vt(o,{delimiter:"-",...e})}function Pt(o){return o===!1?e=>e.toLowerCase():e=>e.toLocaleLowerCase(o)}function xt(o,e={}){const t=e.split??(e.separateNumbers?bt:me),s=e.prefixCharacters??oe,n=e.suffixCharacters??oe;let i=0,c=o.length;for(;i<o.length;){const r=o.charAt(i);if(!s.includes(r))break;i++}for(;c>i;){const r=c-1,a=o.charAt(r);if(!n.includes(a))break;c=r}return[o.slice(0,i),t(o.slice(i,c)),o.slice(c)]}const $=b([]);function St(){const o=e=>{e=e.filter(t=>!$.value.find(s=>s.fontFamily===t.fontFamily)),$.value=[...$.value,...e]};return Ge(()=>({link:$.value.filter(e=>e.preload).map(e=>({key:`preload-${yt(e.fontFamily)}`,rel:"preload",as:"font",href:e.src[0],type:`font/${e.src[1]}`,crossorigin:"anonymous"})),style:[{key:"fonts",innerHTML:Ut($.value)}]})),{registerFont:o}}function Ut(o){return o.map(e=>`
@font-face {
  font-family: "${e.fontFamily}";
  font-variant: ${e.fontVariant};
  font-feature-settings: ${e.fontFeatureSettings};
  font-stretch: ${e.fontStretch};
  font-weight: ${e.fontWeight};
  font-style: ${e.fontStyle};
  font-display: ${e.fontDisplay};
  src: url(${e.src[0]}) format("${e.src[1]}");
}
`).join(`
`)}const Et=""+new URL("open-sans-v43-latin-regular.D-erVzNr.woff2",import.meta.url).href,_t=""+new URL("open-sans-v43-latin-700.BH5mO96r.woff2",import.meta.url).href;function $t(){const{registerFont:o}=St();o([{fontFamily:"Open Sans",fontVariant:"normal",fontFeatureSettings:"normal",fontStretch:"normal",fontWeight:400,fontStyle:"normal",fontDisplay:"swap",src:[Et,"woff2"]},{fontFamily:"Open Sans",fontVariant:"normal",fontFeatureSettings:"normal",fontStretch:"normal",fontWeight:700,fontStyle:"normal",fontDisplay:"swap",src:[_t,"woff2"]}])}const Mt=j({__name:"App",props:{rendererOptions:{}},setup(o){const e=b(null),t=new T,s=b();$t();const n=b(),i=b(null),c=b(null),r=de(()=>i.value?.options.canPlaced);H(async()=>{De(()=>{a()})});function a(){const{renderer:h}=e.value;if(!h)throw new Error("Renderer not ready");n.value=ee(new st(h,[pe])),window.cubyWorld=n.value,n.value.modules.player.setPlayer(new Ke({name:"Player 1"})),n.value.modules.room.fromDescription(new rt),t.add(n.value.modules.selection.selectUnit$.subscribe(p=>{i.value=p?ee(p):null})),t.add(n.value.modules.placement.startPlace$.subscribe(p=>{c.value=p})),t.add(n.value.modules.placement.stopPlace$.subscribe(()=>{c.value=null})),t.add(D(window,"resize",{passive:!0}).subscribe(()=>{y()})),y()}he(()=>{t.unsubscribe(),n.value?.destroy()});const d=b();function y(){const{width:h,height:p}=d.value.getBoundingClientRect();s.value=new P(h,p),e.value?.renderer?.resize(s.value)}function S(){i.value&&i.value.rotateRight()}function m(){i.value&&n.value?.modules.placement?.startPlace(i.value)}return(h,p)=>(v(),_("div",{ref_key:"rootEl",ref:d,class:"cw-app"},[C(je,{ref_key:"rendererEl",ref:e,debug:"",options:h.rendererOptions,modules:[Ve(pt)]},null,8,["options","modules"]),i.value?(v(),M(ht,{key:0,unit:i.value},{actions:E(()=>[C(N,{onClick:S},{default:E(()=>[...p[0]||(p[0]=[L("Rotate",-1)])]),_:1}),r.value?(v(),M(N,{key:0,selected:!!c.value,onClick:m},{default:E(()=>[...p[1]||(p[1]=[L("Move",-1)])]),_:1},8,["selected"])):R("",!0)]),_:1},8,["unit"])):R("",!0),n.value?(v(),M(at,{key:1,app:n.value},null,8,["app"])):R("",!0)],512))}}),Rt=W(Mt,[["__scopeId","data-v-1ece2900"]]),Ct=j({__name:"index",setup(o){return(e,t)=>(v(),_("div",null,[C(Rt)]))}}),At=W(Ct,[["__scopeId","data-v-46b16963"]]);export{At as default};
